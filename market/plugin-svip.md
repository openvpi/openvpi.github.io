# BinSvip

适用格式：X Studio 工程文件 (*.svip)

版本：1.3.0

最后更新日期：2022.12.17

作者：[YQ之神](https://space.bilibili.com/102844209)

-----

## 简介

由于 OpenSVIP 框架的中介模型目前主要是基于 svip 工程文件的数据格式的，因此本插件可以实现几乎无损的完整数据转换。由于输入或输出平台的不同，部分数据可能无法与源平台或目标平台一一对应。

## 环境依赖说明

本插件提供无依赖式读取和写入选项，开启后无需依赖任何软件即可进行工程转换。若您不使用该选项或该选项无法使用，请参阅以下说明。

请注意，此插件依赖 X Studio 的部分动态链接库，这包括 X Studio · 歌手软件安装目录中的以下文件：

- Newtonsoft.Json.dll
- SingingTool.Const.dll
- SingingTool.Library.dll
- SingingTool.Model.dll

但为避免法律纠纷，我们无法将这些动态链接库与插件一同打包。因此，您的系统上需要安装 X Studio · 歌手软件，或安排专门的目录存放这些文件，才可以正常使用本插件。X Studio · 歌手（或上述动态链接库文件）的版本至少应为 1.8 版本（无法支持**力度**参数），推荐使用 2.0 版本。

您可以使用以下方式设定插件所依赖的动态链接库的存放位置（按优先级从高到低排列）：

- 将 X Studio 安装至特定的目录，或将上述动态链接库文件存放至特定的目录，并在转换前将“X Studio 动态链接库路径”高级选项设定为对应的目录；
- 将上述动态链接库文件复制并粘贴至本插件安装路径，即 `%LOCALAPPDATA%\OpenSVIP\Plugins\BinSvip`（可在文件资源管理器路径栏中粘贴并回车跳转，**每次插件更新后需重新操作**）；
- 将已安装的 X Studio 软件设定为 svip 工程文件的默认打开方式，即将注册表项 `HKEY_LOCAL_MACHINE\SOFTWARE\Classes\svipfile\shell\open\command` 设置为类似于 `"C:\Program Files\XStudioSinger\XStudioSinger.exe" "%1"` 的形式（[如何打开注册表编辑器](https://support.microsoft.com/zh-cn/windows/%E5%9C%A8-windows-10-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%93%E5%BC%80%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%BC%96%E8%BE%91%E5%99%A8-deab38e6-91d6-e0aa-4b7c-8878d9e07b11)）。

插件在运行前将依次扫描这些路径，若缺少某个必需的文件，将会抛出报错信息。您不一定需要将所有的文件存放于同一个目录，插件运行时将依据以上优先级进行加载。

## 数据支持清单

### 读取 X Studio 工程文件

| 数据内容 | 支持等级 |                             说明                             |
| :------: | :------: | :----------------------------------------------------------: |
|   轨道   |    ✓     |                                                              |
|   曲谱   |    ✓     |                                                              |
|   歌词   |    ✓     |                                                              |
| 唱法标记 |    ✓     |                                                              |
|   颤音   |    ×     | 由于在 X Studio 中添加的颤音会被立即写入音高参数，因此无需支持读取。 |
| 音高参数 |    ✓     |                                                              |
| 音素参数 |    ✓     |                                                              |
| 音量参数 |    ✓     |                                                              |
| 气声参数 |    ✓     |                                                              |
| 性别参数 |    ✓     |                                                              |
| 力度参数 |    ○     | 需要安装 X Studio 2.0 及以上版本或打开无依赖式读取选项才支持读取。 |

### 写入 X Studio 工程文件

| 数据内容 | 支持等级 |                             说明                             |
| :------: | :------: | :----------------------------------------------------------: |
|   轨道   |    ✓     |                                                              |
|   曲谱   |    ✓     |                                                              |
|   歌词   |    ○     | 原则上仅支持中文歌词导入。源格式中的歌词包含字母（通常为汉语拼音或罗马音）时将以“修改发音”转换。可能因此产生不在 X Studio 发音表内的音节，从而导致无法直接播放。 |
| 唱法标记 |    ✓     |                                                              |
|   颤音   |    ×     | 由于 X Studio 仅根据音高参数进行合成，因此不支持单独写入颤音。 |
| 音高参数 |    ✓     | 源格式中任何对音高曲线产生影响的数据（例如“音高偏差”“颤音”）将被映射至音高参数。 |
| 音素参数 |    ✓     | 源格式中任何对音素长短产生影响的数据（例如“辅音长度”）将被映射至音素参数。 |
| 音量参数 |    ✓     |            源格式中的音量包络将被映射至音量参数。            |
| 气声参数 |    ✓     |     源格式中对气息强度产生影响的数据将被映射至气声参数。     |
| 性别参数 |    ✓     |      源格式中对共振峰产生影响的数据将被映射至性别参数。      |
| 力度参数 |    ○     | 需要安装 X Studio 2.0 及以上版本或打开无依赖式写入选项才支持写入。源格式中任何对演唱力度产生影响的数据（例如“张力”“力度”）将被映射至力度参数。 |

## 高级选项

### 输入选项

#### 无依赖式读取

贡献者：[至精至简](https://space.bilibili.com/87172593)

打开此选项后插件无需依赖 X Studio 动态链接库即可读取完整格式的工程文件。若使用此选项时出现转换异常，请关闭选项重试，并向开发者报告问题。

#### X Studio 动态链接库路径

此选项的作用已在[环境依赖说明](#环境依赖说明)中进行了解释。如果您的系统上安装了或存放了多个版本的 X Studio，您可以使用此选项指定您希望使用的那一个；如果您不准备在自己的系统上保留 X Studio，您可以只将本插件所需的几个动态链接库文件保存到一个目录，随后使用本选项指定路径。

### 输出选项

#### 无依赖式写入

贡献者：[至精至简](https://space.bilibili.com/87172593)

打开此选项后插件无需依赖 X Studio 动态链接库即可写入完整格式的工程文件。若使用此选项时出现转换异常，请关闭选项重试，并向开发者报告问题。

#### 缺省歌手

可以指定输出工程文件中的歌手。必须输入完整无误的歌手名字。若此选项指定的歌手不存在，将使用 X Studio 中设置的默认歌手。如果要指定歌手编号与名称的转换关系，或添加已拥有编号但未公开发行的歌手，请修改插件目录下的 SingerDict.json。

#### 缺省曲速

X Studio 支持的曲速范围为 20 ~ 300。曲速超出范围时，将会启用绝对时间轴以确保音符对齐。请尽量将此值设置为源工程文件中曲速的整数倍或整数分之一；只要在合理数值范围内，此选项的值不会影响对齐效果。

#### 输出文件版本

此选项仅控制输出工程文件的头部版本信息。选择较旧的工程文件版本不会造成数据丢失。

此选项支持的值如下：

- 自动选择：使用系统上安装的 X Studio 所对应的工程文件版本
- SVIP 7.0.0：使用 X Studio 2.0 对应的工程文件版本
- SVIP 6.0.0：使用兼容 X Studio 1.8 的工程文件版本
- 最大只读兼容：使用兼容任意版本 X Studio 的工程文件版本

> **[!NOTE]**
>
> 各版本的 X Studio 均有一个对应的工程文件版本号。例如，X Studio 1.8（最高支持 SVIP6.0.0）无法打开由 X Studio 2.0（对应 SVIP7.0.0）保存的工程文件。将头部信息设置为较低版本可以增强兼容性，例如使 X Studio 1.8 能够打开包含力度参数的工程文件（尽管不会在编辑器中显示）。
>
> **注意：能够打开并不意味着能够无损保存。例如，使用 X Studio 1.8 编辑并保存包含力度参数的工程文件，会导致力度参数永久丢失，即使再次使用 X Studio 2.0 打开也无法恢复。<font color="red">若选择保存为“最大只读兼容”，将导致音量、气声、性别、力度参数无法被 X Studio 识别（数据没有丢失）。为了避免无法挽回的数据丢失，强烈建议不要使用 X Studio 修改和保存使用此选项导出的工程文件。若要重新将工程文件恢复至可安全编辑的状态，请选择保存为 SVIP 6.0.0 及以上版本。</font>**

#### X Studio 动态链接库路径

同输入选项。

## 更新日志

#### v1.3.0 (2022.12.17)

- 支持无依赖式读取和写入，开启后无需安装 X Studio 即可转换

#### v1.2.0 (2022.08.10)

- 支持设定 X Studio 动态链接库路径，

#### v1.1.6 (2022.05.30)

- 修复了一个导致所有人都转换失败的愚蠢 bug

在此为没有做好测试工作向所有受影响的用户表示由衷的歉意。

#### v1.1.5 (2022.05.26)

- 针对“最大兼容性”选项可能导致的数据丢失风险，添加警告信息
- “最大兼容性”选项改名为“最大只读兼容”
- 更新后使用本插件重新输出为 SVIP 6.0.0 及以上版本，可以从“最大兼容性”工程文件中恢复无法被 X Studio 识别的参数

#### v1.1.4 (2022.05.23)

- 修复了未安装 X Studio 时未能正确显示错误信息的 bug

#### v1.1.3 (2022.05.21)

- 新增“最大兼容性”选项，支持导出兼容任意版本 X Studio 的工程文件

#### v1.1.2 (2022.05.06)

随转换器公测发布

## 开源声明

本插件使用和参考了以下第三方开源项目：

|    开源项目     |                            许可证                            |               相关链接               |
| :-------------: | :----------------------------------------------------------: | :----------------------------------: |
| Newtonsoft.Json |        [MIT License](https://licenses.nuget.org/MIT)         |   https://www.newtonsoft.com/json    |
|      QNrbf      | [LGPL 2.1 License](https://www.gnu.org/licenses/old-licenses/lgpl-2.1.html) | https://github.com/SineStriker/QNrbf |

